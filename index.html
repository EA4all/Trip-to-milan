<!-- Version 1.0 -->
<!DOCTYPE html>
<html lang="he" dir="rtl" class="scroll-smooth dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>תוכנית טיול שיתופית למילאנו (v1.0)</title>
  <meta name="description" content="דשבורד אינטראקטיבי ושיתופי לתכנון חופשה במילאנו: לוז יומי, מפות, מזג אוויר, סיכום טיול חכם, מעקב תקציב ועוד." />
  <meta name="theme-color" content="#1d4ed8">
  <link rel="manifest" href="manifest.json">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { 
            sans: ['Assistant', 'ui-sans-serif', 'system-ui'],
          },
          colors: {
            brand: {
              50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd',
              400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a'
            }
          }
        }
      }
    };
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- LeafletJS for Live Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <style>
    :root{
      --bg: #f9fafb; --fg:#1f2937; --card:#ffffff; --muted:#6b7280;
      --btn:#1d4ed8; --btn-h:#1e40af; --brd:#e5e7eb;
      --header-bg: rgba(255,255,255,0.9);
      --heading-font: 'Assistant', sans-serif;
    }
    .dark{
      --bg:#0b1220; --fg:#e5e7eb; --card:#0f172a; --muted:#9ca3af;
      --btn:#2563eb; --btn-h:#1d4ed8; --brd:#1f2937;
      --header-bg: rgba(11,18,32,0.8);
    }
    
    html { scroll-padding-top: 80px; }
    body{background:var(--bg); color:var(--fg); font-family:Assistant,ui-sans-serif,system-ui;}
    h2, h3 { font-family: var(--heading-font); }
    #site-header { background-color: var(--header-bg); }
    
    .dark input, .dark textarea, .dark select {
        background-color: #1f2937;
        color: var(--fg);
        border-color: #374151;
    }
    .dark input::placeholder, .dark textarea::placeholder { color: var(--muted); }

    .btn{display:inline-flex;align-items:center;gap:.5rem;justify-content:center;border-radius:0.75rem;
         font-weight:600;font-size:.9rem;padding:.5rem .85rem;transition:.2s;border:1px solid transparent}
    .btn:disabled { opacity: 0.7; cursor: not-allowed; }
    .btn-primary{background:var(--btn);color:#fff;}
    .btn-primary:hover{background:var(--btn-h)}
    .btn-ghost{background:transparent;border-color:var(--brd);color:var(--fg);}
    .btn-ghost:hover{background:rgba(0,0,0,.04)}
    .dark .btn-ghost:hover{background:rgba(255,255,255,.06)}
    .tab-button{padding:.5rem .75rem;font-weight:700;border-bottom:2px solid transparent;border-radius:.5rem .5rem 0 0;}
    .tab-active{color:var(--btn);background:var(--card);border-color:var(--btn)}
    #gemini-tabs-nav .tab-button { border-color: transparent; }
    #gemini-tabs-nav .tab-active { border-color: var(--btn); color: var(--btn); }

    .content-section{display:none}
    .content-section.active{display:block}
    .thumb{width:100%;height:14rem;object-fit:cover}
    .logo{width:56px;height:56px;border-radius:.75rem;border:1px solid var(--brd);object-fit:contain;background:#fff}
    
    .modal-backdrop {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0, 0, 0, 0.6); z-index: 100;
        display: none; align-items: center; justify-content: center;
        backdrop-filter: blur(4px);
    }
    .modal-backdrop.flex { display: flex; }
    .modal {
        background: var(--card); color: var(--fg);
        width: 90%; max-width: 500px; border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        display: flex; flex-direction: column; max-height: 80vh;
    }
    .image-carousel { position: relative; flex-shrink:0; width:100%; }
    @media (min-width: 768px) { .image-carousel { width: 33.333333%; } }
    .image-carousel button {
      position: absolute; top: 50%; transform: translateY(-50%);
      background-color: rgba(0,0,0,0.4); color: white;
      border: none; border-radius: 50%;
      width: 32px; height: 32px;
      cursor: pointer; transition: background-color 0.2s;
    }
    .image-carousel button:hover { background-color: rgba(0,0,0,0.7); }
    .carousel-prev { left: 8px; }
    .carousel-next { right: 8px; }

    .countdown-number { font-size: 1.5rem; line-height: 1; }
    .countdown-label { font-size: 0.75rem; }

    .floating-submenu {
        transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        transform: translateY(100%);
        opacity: 0;
        pointer-events: none;
    }
    .floating-submenu.active {
        transform: translateY(0);
        opacity: 1;
        pointer-events: auto;
    }

    .delete-btn {
        position: absolute; top: 4px; right: 4px;
        background-color: rgba(239, 68, 68, 0.7);
        color: white; border-radius: 50%;
        width: 24px; height: 24px;
        border: none; cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        opacity: 0; transition: opacity 0.2s; z-index: 10;
    }
    .relative:hover .delete-btn { opacity: 1; }
    
    #live-location-map {
        height: 350px;
        border-radius: 1rem;
        border: 1px solid var(--brd);
    }
    .leaflet-popup-content-wrapper {
        background: var(--card);
        color: var(--fg);
    }
    .leaflet-popup-tip {
        background: var(--card);
    }


    @media print {
        body * { visibility: hidden; }
        #plan, #plan * { visibility: visible; }
        #plan { position: absolute; left: 0; top: 0; width: 100%; }
        #plan details { page-break-inside: avoid; }
        #plan summary, .nav-link, .btn, header, main > section:not(#plan), #floating-nav-container, .day-actions { display: none !important; }
        #plan details[open] > div { display: block !important; }
        #plan-content-container { padding: 0 !important; }
        h2 { font-size: 24px !important; }
        #plan details {
            box-shadow: none !important;
            border: 1px solid #ccc;
            margin-bottom: 1rem;
        }
    }


    @media (max-width: 767px) {
      body { padding-bottom: 70px; } /* Add padding for floating nav */
      .responsive-table thead { display: none; }
      .responsive-table tr {
        display: block; margin-bottom: 1rem; border: 1px solid var(--brd);
        border-radius: 0.75rem; padding: 1rem;
      }
      .responsive-table td {
        display: flex; justify-content: space-between; align-items: center;
        padding: 0.5rem 0; border-bottom: 1px solid var(--brd);
      }
      .responsive-table td:last-child { border-bottom: none; }
      .responsive-table td::before {
        content: attr(data-label); font-weight: 600; margin-right: 1rem;
      }
      .responsive-table .logo-cell { justify-content: center; padding-bottom: 1rem; }
      .responsive-table .logo-cell::before { display: none; }
    }
  </style>
</head>
<body class="dark:bg-gray-900 dark:text-gray-100">

  <header id="site-header" class="backdrop-blur shadow-md sticky top-0 z-50">
    <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-3">
          <span class="inline-block w-2 h-6 rounded bg-brand-700"></span>
          <h1 class="text-xl md:text-2xl font-bold text-brand-800 dark:text-brand-300">החופשה במילאנו</h1>
        </div>
        <div class="hidden md:flex md:items-center md:gap-1 flex-wrap">
          <a href="#overview" class="nav-link px-3 py-2 rounded-md text-sm font-medium">סקירה</a>
          <a href="#plan" class="nav-link px-3 py-2 rounded-md text-sm font-medium">תוכנית</a>
          <a href="#suggestions" class="nav-link px-3 py-2 rounded-md text-sm font-medium">הצעות</a>
          <a href="#kosher" class="nav-link px-3 py-2 rounded-md text-sm font-medium">אוכל כשר</a>
          <a href="#tools" class="nav-link px-3 py-2 rounded-md text-sm font-medium">כלים</a>
        </div>
        <div class="flex items-center gap-2">
            <div id="sync-status" class="text-xs text-gray-400 flex items-center gap-2" title="מתחבר...">
                <i class="fa-solid fa-cloud text-yellow-500"></i> <span class="hidden sm:inline">מתחבר...</span>
            </div>
            <button id="theme-toggle" class="btn btn-ghost" aria-label="החלפת מצב"><i class="fa-solid fa-sun"></i></button>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mx-auto p-4 sm:p-6 lg:p-8">

    <section id="overview" class="my-12 scroll-mt-24">
      <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
        <h2 class="text-3xl font-bold text-center text-brand-900 dark:text-brand-300">סקירה כללית</h2>
        <div class="flex gap-2 flex-wrap justify-center">
            <button id="share-btn" class="btn btn-primary"><i class="fa-solid fa-share-alt mr-2"></i>שתף תוכנית</button>
            <button id="gemini-btn" class="btn btn-primary"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>שאל את Gemini</button>
            <button id="find-nearby-btn" class="btn btn-primary"><i class="fa-solid fa-location-crosshairs mr-2"></i>מצא מקומות קרובים</button>
            <button id="show-tip-btn" class="btn btn-primary"><i class="fa-solid fa-lightbulb mr-2"></i>טיפ יומי</button>
            <button id="create-summary-btn" class="btn btn-primary bg-green-600 hover:bg-green-700"><i class="fa-solid fa-book-open mr-2"></i>צור סיכום טיול</button>
        </div>
      </div>
      <div id="overview-cards" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <section id="plan" class="my-12 scroll-mt-24">
      <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <h2 class="text-3xl font-bold text-center text-brand-900 dark:text-brand-300">תוכנית הטיול היומית</h2>
        <div class="flex gap-2 flex-wrap justify-center day-actions">
            <button id="collapse-all" class="btn btn-ghost btn-sm"><i class="fa-solid fa-compress mr-1"></i>כווץ הכל</button>
            <button id="expand-all" class="btn btn-ghost btn-sm"><i class="fa-solid fa-expand mr-1"></i>הרחב הכל</button>
            <button id="print-btn" class="btn btn-ghost btn-sm"><i class="fa-solid fa-print mr-1"></i>הדפס תוכנית</button>
        </div>
      </div>
      <div class="bg-white dark:bg-gray-950 p-2 sm:p-6 rounded-2xl shadow-lg">
        <div class="border-b border-gray-200 dark:border-gray-800 mb-6">
          <nav class="-mb-px flex flex-wrap justify-center gap-2 sm:gap-4" aria-label="Tabs" id="day-tabs-nav"></nav>
        </div>
        <div id="plan-content-container"></div>
      </div>
    </section>
    
    <section id="suggestions" class="my-12 scroll-mt-24">
        <h2 class="text-3xl font-bold text-center text-brand-900 dark:text-brand-300 mb-6">מאגר הצעות</h2>
        <div class="text-center">
            <button id="toggle-suggestions-btn" class="btn btn-primary">הצג הצעות נוספות</button>
        </div>
        <div id="suggestions-container" class="hidden mt-6 bg-white dark:bg-gray-950 p-4 sm:p-6 rounded-2xl shadow-lg">
            <div id="suggestions-table-container"></div>
        </div>
    </section>

    <section id="kosher" class="my-12 scroll-mt-24">
      <h2 class="text-3xl font-bold text-center text-brand-900 dark:text-brand-300 mb-6">המדריך הקולינרי הכשר</h2>
      <div class="text-center">
        <button id="toggle-kosher-btn" class="btn btn-primary">הצג מדריך כשרות</button>
      </div>
      <div id="kosher-container" class="hidden mt-6">
        <div class="bg-white dark:bg-gray-950 p-4 sm:p-6 rounded-2xl shadow-lg">
          <p id="kosher-subtitle" class="text-center mb-6 text-gray-600 dark:text-gray-400">ריכוז האפשרויות בשכונות Bande Nere ו‑Washington.</p>
          <div id="kosher-filters" class="mb-4 flex flex-wrap gap-2 justify-center"></div>
          <div id="kosher-results"></div>
        </div>
      </div>
    </section>
    
    <section id="tools" class="my-12 scroll-mt-24">
        <h2 class="text-3xl font-bold text-center text-brand-900 dark:text-brand-300 mb-6">כלים ומידע שימושי</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            
            <div id="live-location-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg scroll-mt-24 lg:col-span-3">
                <h3 class="text-xl font-bold mb-3 text-center"><i class="fa-solid fa-map-location-dot mr-2"></i>מפת מיקום חי</h3>
                <div class="text-center">
                    <p class="mb-4">כל משתמש עם הלינק יכול לראות את מיקום המטיילים בזמן אמת. רק המטיילים צריכים ללחוץ על "שתף מיקום".</p>
                    <div id="live-location-map" class="mb-4"></div>
                    <div class="flex flex-col sm:flex-row gap-2 justify-center">
                        <button id="toggle-location-sharing-btn" class="btn btn-primary"><i class="fa-solid fa-tower-broadcast mr-2"></i>הפעל שיתוף מיקום</button>
                        <input type="text" id="user-name-input" placeholder="הכנס את שמך (לזיהוי)" class="p-2 rounded-lg border text-center">
                    </div>
                    <p id="location-status" class="text-xs text-gray-500 mt-2 h-4"></p>
                </div>
            </div>

            <div id="transport-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg scroll-mt-24 lg:col-span-3">
                <h3 class="text-xl font-bold mb-3 text-center"><i class="fa-solid fa-bus mr-2"></i>מדריך תחבורה</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-lg font-bold text-brand-800 dark:text-brand-200 mb-3">תחבורה ציבורית (ATM)</h4>
                        <ul class="space-y-3 list-disc list-inside text-gray-700 dark:text-gray-300">
                            <li><span class="font-semibold">איפה קונים:</span> במכונות האוטומטיות בכל תחנת מטרו, בקיוסקים (Tabacchi), או באפליקציה הרשמית <a href="https://www.atm.it/it/Pagine/default.aspx" target="_blank" class="text-brand-600 dark:text-brand-400 hover:underline">ATM Milano</a>.</li>
                            <li><span class="font-semibold">המלצה:</span> כרטיס ל-3 ימים (72 שעות) הוא המשתלם ביותר לשהייה שלכם.</li>
                        </ul>
                        <div class="relative h-[280px] mt-4">
                            <canvas id="transportChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold text-brand-800 dark:text-brand-200 mb-3">רכבות לטיולי יום</h4>
                        <ul class="space-y-3 list-disc list-inside text-gray-700 dark:text-gray-300">
                            <li><span class="font-semibold">איפה קונים:</span> מומלץ להזמין מראש באינטרנט כדי להבטיח מקום ומחיר טוב.</li>
                            <li><span class="font-semibold">אתרים מומלצים:</span> <a href="https://www.trenitalia.com/en.html" target="_blank" class="text-brand-600 dark:text-brand-400 hover:underline">Trenitalia</a> (רשמי) או <a href="https://www.italotreno.it/en" target="_blank" class="text-brand-600 dark:text-brand-400 hover:underline">Italo</a> (פרטי).</li>
                            <li><span class="font-semibold">תחנת יציאה:</span> כל הרכבות לאגמים יוצאות מתחנת **Milano Centrale**.</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div id="weather-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg scroll-mt-24 lg:col-span-1">
                <h3 class="text-xl font-bold mb-3"><i class="fa-solid fa-cloud-sun mr-2"></i>מזג אוויר</h3>
                <div id="weather-forecast" class="space-y-3"><p>טוען תחזית...</p></div>
                <div id="weather-attire-recommendation" class="mt-4 pt-3 border-t border-gray-200 dark:border-gray-700 text-sm text-center"></div>
            </div>
            <div id="budget-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg flex flex-col scroll-mt-24 md:col-span-2 lg:col-span-2">
                <h3 class="text-xl font-bold mb-3"><i class="fa-solid fa-euro-sign mr-2"></i>מעקב תקציב</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 flex-grow">
                    <div>
                        <div class="mb-4">
                            <label for="total-budget" class="block text-sm font-medium">תקציב כללי (€)</label>
                            <input type="number" id="total-budget" placeholder="הזן תקציב" class="w-full p-2 mt-1 rounded-xl border border-gray-300 bg-white">
                        </div>
                        <form id="expense-form" class="space-y-3">
                            <input type="text" id="expense-desc" placeholder="תיאור ההוצאה" class="w-full p-2 rounded-xl border" required>
                             <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="expense-amount" placeholder="סכום (€)" class="w-full p-2 rounded-xl border" required>
                                <select id="expense-category" class="w-full p-2 rounded-xl border" required>
                                    <option value="">קטגוריה</option>
                                    <option value="אוכל">אוכל</option>
                                    <option value="קניות">קניות</option>
                                    <option value="תחבורה">תחבורה</option>
                                    <option value="אטרקציות">אטרקציות</option>
                                    <option value="אחר">אחר</option>
                                </select>
                             </div>
                            <button type="submit" class="btn btn-primary w-full">הוסף הוצאה</button>
                        </form>
                        <button id="calculate-estimated-btn" class="btn btn-primary w-full mt-2"><i class="fa-solid fa-calculator mr-2"></i>חשב עלות משוערת לאטרקציות</button>
                        <div id="expense-list" class="text-sm my-4 flex-grow max-h-40 overflow-y-auto pr-2"></div>
                        <div class="mt-auto pt-3 border-t font-bold space-y-2 text-md">
                             <div class="flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <span>עלות משוערת</span>
                                    <input type="checkbox" id="include-estimated-costs" checked class="w-4 h-4 rounded text-brand-600 focus:ring-brand-500" title="כלול בחישוב היתרה">
                                </div>
                                <span id="estimated-costs">0.00€</span>
                            </div>
                            <div class="flex justify-between text-red-600 dark:text-red-400"><span>הוצאות בפועל:</span> <span id="total-expenses">0.00</span>€</div>
                            <div class="flex justify-between text-green-600 dark:text-green-400"><span>יתרה:</span> <span id="budget-balance">0.00</span>€</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-center justify-center min-h-[200px]">
                        <div class="relative w-full h-full max-h-[250px]">
                            <canvas id="budget-chart"></canvas>
                        </div>
                        <div id="budget-chart-placeholder" class="hidden text-center text-gray-400 text-sm">הוסיפו הוצאות כדי לראות את התרשים</div>
                        <div id="budget-chart-legend" class="mt-4 w-full space-y-1"></div>
                    </div>
                </div>
            </div>
            <div id="checklist-section-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg scroll-mt-24 lg:col-span-1">
                <h3 class="text-xl font-bold mb-3"><i class="fa-solid fa-list-check mr-2"></i>צ'ק-ליסט</h3>
                <form id="add-checklist-item-form" class="grid sm:grid-cols-3 gap-2 mb-4">
                    <input type="text" id="new-item-text" placeholder="פריט חדש" class="sm:col-span-2 w-full p-2 rounded-lg border" required>
                    <select id="category-select" class="w-full p-2 rounded-lg border"></select>
                    <input type="text" id="new-category-text" placeholder="קטגוריה חדשה (אופציונלי)" class="sm:col-span-2 w-full p-2 rounded-lg border">
                    <button type="submit" class="btn btn-primary">הוסף</button>
                </form>
                <div id="checklist-container" class="space-y-4 max-h-96 overflow-y-auto"></div>
            </div>
            <div id="translator-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg flex flex-col scroll-mt-24 lg:col-span-1">
                <h3 class="text-xl font-bold mb-3"><i class="fa-solid fa-language mr-2"></i>תרגומון</h3>
                <div class="text-xs text-center text-gray-500 mb-2" id="lang-direction-label">עברית <i class="fa-solid fa-arrow-right-long"></i> איטלקית</div>
                <form id="dictionary-form" class="grid grid-cols-4 gap-2 mb-3">
                   <input type="text" id="dictionary-input" placeholder="הקלד לתרגום..." class="col-span-4 w-full p-2 rounded-lg border">
                   <button type="button" id="swap-lang-btn" class="btn btn-ghost" title="החלף שפות"><i class="fa-solid fa-exchange-alt"></i></button>
                   <button type="submit" class="btn btn-primary col-span-1">תרגם</button>
                   <button type="button" id="translate-upload-btn" class="btn btn-ghost" title="העלה תמונה"><i class="fa-solid fa-file-image"></i></button>
                   <button type="button" id="translate-camera-btn" class="btn btn-ghost" title="פתח מצלמה"><i class="fa-solid fa-camera"></i></button>
                   <input type="file" id="image-translate-upload" class="hidden" accept="image/*">
                </form>
                <div id="translation-result-container" class="mt-2 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg min-h-[60px] text-center flex items-center justify-center gap-3">
                   <span class="text-gray-500">התרגום יופיע כאן...</span>
                </div>
                <div id="translation-history" class="mt-3 pt-3 border-t text-xs space-y-2 max-h-24 overflow-y-auto">
                    <div class="text-center text-gray-400">היסטוריית תרגומים</div>
                </div>
           </div>
           <div id="converter-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg flex flex-col scroll-mt-24 lg:col-span-1">
             <h3 class="text-xl font-bold mb-3"><i class="fa-solid fa-right-left mr-2"></i>ממיר מטבע</h3>
             <div class="space-y-4">
                 <div>
                     <label for="eur-input" class="block text-sm font-medium">אירו (€)</label>
                     <input type="number" id="eur-input" placeholder="EUR" class="w-full p-2 mt-1 rounded-xl border">
                 </div>
                 <div>
                     <label for="ils-input" class="block text-sm font-medium">שקל (₪)</label>
                     <input type="number" id="ils-input" placeholder="ILS" class="w-full p-2 mt-1 rounded-xl border">
                 </div>
             </div>
             <p id="exchange-rate-display" class="text-xs text-gray-500 mt-auto pt-3 text-center">טוען שער חליפין...</p>
         </div>
         <div id="safety-warnings-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg scroll-mt-24 lg:col-span-1">
            <h3 class="text-xl font-bold mb-3"><i class="fa-solid fa-triangle-exclamation mr-2"></i>אזהרות ועדכונים</h3>
            <div id="safety-warnings-content" class="text-sm space-y-2 max-h-48 overflow-y-auto">טוען מידע...</div>
            <button id="refresh-warnings-btn" class="btn btn-ghost w-full mt-3">רענן מידע</button>
        </div>
        <div id="customs-info-tool" class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg scroll-mt-24 md:col-span-2 lg:col-span-2">
            <h3 class="text-xl font-bold mb-3"><i class="fa-solid fa-suitcase-rolling mr-2"></i>מידע על מכס וכבודה</h3>
            <div class="text-sm space-y-2">
                <p><b><i class="fa-solid fa-right-to-bracket"></i> מכס בכניסה לאיטליה (לנוסע, מחוץ לאיחוד):</b></p>
                <ul class="list-disc list-inside text-gray-600 dark:text-gray-400 text-xs">
                    <li><b>טבק:</b> 200 סיגריות או 50 סיגרים.</li>
                    <li><b>אלכוהול:</b> 1 ליטר של אלכוהול מעל 22% (כמו וודקה) או 2 ליטר יין.</li>
                    <li><b>מזומן:</b> יש להצהיר על סכומים מעל 10,000 אירו.</li>
                    <li><b>איסורים:</b> אסור להכניס מוצרי בשר וחלב מחוץ לאיחוד האירופי.</li>
                </ul>
                <p class="mt-3"><b><i class="fa-solid fa-left-to-bracket"></i> מכס בחזרה לישראל (לנוסע):</b></p>
                <ul class="list-disc list-inside text-gray-600 dark:text-gray-400 text-xs">
                    <li><b>פטור אישי:</b> ניתן להכניס מתנות וחפצים אישיים בשווי כולל של עד 200$ לנוסע (מעל גיל שנתיים).</li>
                    <li><b>מזון:</b> עד 3 ק"ג מזון, בתנאי שכל פריט לא שוקל יותר מ-1 ק"ג.</li>
                    <li><b>טבק (מעל גיל 18):</b> 200 סיגריות (פֿקט אחד) או 250 גרם מוצרי טבק אחרים.</li>
                    <li><b>אלכוהול (מעל גיל 18):</b> 1 ליטר של משקה חריף ו-2 ליטר יין.</li>
                    <li><b>חשוב:</b> הפטור הוא אישי ולא ניתן לצבירה למספר אנשים.</li>
                </ul>
            </div>
        </div>
        </div>
    </section>

    <section id="documents-and-gallery" class="my-12 scroll-mt-24 grid md:grid-cols-2 gap-6">
        <div class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4"><i class="fa-solid fa-folder-open mr-2"></i>תיק מסמכים</h2>
            <input type="file" id="document-upload" multiple class="hidden">
            <button id="document-upload-btn" class="btn btn-primary w-full mb-4">העלה מסמכים</button>
            <div id="documents-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
        </div>
        <div class="bg-white dark:bg-gray-950 p-6 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4"><i class="fa-solid fa-images mr-2"></i>גלריית תמונות</h2>
            <input type="file" id="image-upload" multiple accept="image/*" class="hidden">
            <button id="image-upload-btn" class="btn btn-primary w-full mb-4">העלה תמונות</button>
            <div id="gallery-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
        </div>
    </section>

  </main>
  
  <div id="add-to-day-modal" class="modal-backdrop">
    <div class="modal">
        <div class="p-4 border-b"><h3 class="text-lg font-bold">הוסף פעילות ליום...</h3></div>
        <div id="modal-day-options" class="p-4 grid grid-cols-2 gap-3"></div>
        <div class="p-4 border-t flex justify-end">
            <button onclick="window.closeModal()" class="btn btn-ghost">ביטול</button>
        </div>
    </div>
  </div>
  <div id="camera-modal" class="modal-backdrop">
    <div class="modal">
        <div class="p-4 border-b flex justify-between items-center"><h3 class="text-lg font-bold">תרגם מתמונה</h3><button id="camera-close-btn" class="text-2xl">×</button></div>
        <div class="p-4 flex-grow relative">
            <video id="camera-feed" class="w-full h-full object-cover bg-black rounded-lg" playsinline autoplay></video>
            <canvas id="camera-canvas" class="hidden"></canvas>
        </div>
        <div class="p-4 border-t flex justify-center">
            <button id="capture-btn" class="btn btn-primary w-16 h-16 rounded-full"><i class="fa-solid fa-camera fa-2x"></i></button>
        </div>
    </div>
  </div>
  <div id="alert-modal" class="modal-backdrop">
    <div class="modal">
        <div class="p-4 border-b flex justify-between items-center">
            <h3 id="alert-modal-title" class="text-lg font-bold"></h3>
            <button id="alert-modal-copy-btn" class="btn btn-ghost btn-sm hidden"><i class="fa-solid fa-copy mr-1"></i>העתק</button>
        </div>
        <div id="alert-modal-body" class="p-6 whitespace-pre-wrap max-h-[50vh] overflow-y-auto"></div>
        <div class="p-4 border-t flex justify-end">
            <button id="alert-modal-close" class="btn btn-primary">הבנתי</button>
        </div>
    </div>
  </div>
    <div id="gemini-modal" class="modal-backdrop">
      <div class="modal">
          <div class="p-4 border-b flex justify-between items-center">
              <h3 class="text-lg font-bold">שאל את Gemini</h3>
              <button id="gemini-close-btn" class="text-2xl">×</button>
          </div>
          <div class="border-b border-gray-200 dark:border-gray-800">
              <nav class="-mb-px flex justify-center gap-4" id="gemini-tabs-nav">
                  <button class="py-3 px-4 font-semibold border-b-2 tab-button tab-active" data-content="gemini-advisor-tab">יועץ חכם</button>
                  <button class="py-3 px-4 font-semibold border-b-2 tab-button" data-content="gemini-free-text-tab">שאלה חופשית</button>
              </nav>
          </div>
          <div class="p-4 flex-grow overflow-y-auto flex flex-col">
              <!-- Smart Advisor Tab -->
              <div id="gemini-advisor-tab" class="content-section active text-center">
                  <p class="mb-4">קבל המלצה חכמה ומותאמת אישית על סמך השעה, מזג האוויר והתקציב שלך.</p>
                  <button id="get-smart-advice-btn" class="btn btn-primary"><i class="fa-solid fa-robot mr-2"></i>תן לי המלצה חכמה</button>
              </div>
              <!-- Free Text Tab -->
              <div id="gemini-free-text-tab" class="content-section">
                  <label for="gemini-prompt" class="block text-sm font-medium mb-1">הכנס שאלה או בקשה:</label>
                  <textarea id="gemini-prompt" class="w-full p-2 rounded-lg border bg-white dark:bg-gray-800" rows="3" placeholder="לדוגמה: תן לי 3 הצעות למסעדות רומנטיות בערב באזור נבילי."></textarea>
                   <button id="gemini-submit-btn" class="btn btn-primary w-full mt-2">שלח שאילתה</button>
              </div>
              
              <div class="mt-4 flex-grow flex flex-col">
                  <h4 class="font-semibold mb-2">תשובה:</h4>
                  <div id="gemini-response" class="p-3 bg-gray-100 dark:bg-gray-800 rounded-lg min-h-[100px] whitespace-pre-wrap flex-grow"></div>
              </div>
          </div>
      </div>
    </div>
<div id="daily-tip-modal" class="modal-backdrop">
    <div class="modal">
        <div class="p-4 border-b flex items-center gap-3">
            <i class="fa-solid fa-lightbulb text-yellow-400 text-xl"></i>
            <h3 class="text-lg font-bold">טיפ היום למטייל</h3>
        </div>
        <div id="daily-tip-body" class="p-6 whitespace-pre-wrap">טוען טיפ...</div>
        <div class="p-4 border-t flex justify-end">
            <button id="daily-tip-close" class="btn btn-primary">הבנתי</button>
        </div>
    </div>
</div>



  <div id="floating-nav-container" class="md:hidden fixed bottom-0 left-0 right-0 z-40">
      <div id="plan-submenu" class="floating-submenu fixed bottom-[68px] left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm p-2 rounded-t-2xl">
          <div class="grid grid-cols-3 gap-2 text-center text-sm" id="plan-submenu-links">
              </div>
      </div>
      <div id="tools-submenu" class="floating-submenu fixed bottom-[68px] left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm p-2 rounded-t-2xl">
          <div class="grid grid-cols-3 gap-2 text-center text-sm">
              <a href="#overview" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 col-span-3 font-bold text-brand-600">חזור לסקירה</a>
              <a href="#live-location-tool" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">מיקום חי</a>
              <a href="#transport-tool" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">תחבורה</a>
              <a href="#weather-tool" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">מזג אוויר</a>
              <a href="#budget-tool" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">תקציב</a>
              <a href="#checklist-section-tool" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">צ'קליסט</a>
              <a href="#translator-tool" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">תרגום</a>
              <a href="#converter-tool" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">ממיר מטבע</a>
              <a href="#safety-warnings-tool" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">אזהרות</a>
          </div>
      </div>

      <nav id="floating-nav" class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm shadow-[0_-2px_10px_rgba(0,0,0,0.1)] dark:shadow-[0_-2px_10px_rgba(0,0,0,0.3)] rounded-t-2xl">
        <div class="flex justify-around p-2 text-gray-700 dark:text-gray-300">
            <button id="floating-plan-btn" class="flex flex-col items-center text-xs gap-1 p-1 hover:text-brand-600 w-1/4">
                <i class="fa-solid fa-calendar-days fa-lg"></i>
                <span>תוכנית</span>
            </button>
            <a href="#kosher" class="flex flex-col items-center text-xs gap-1 p-1 hover:text-brand-600 w-1/4">
                <i class="fa-solid fa-utensils fa-lg"></i>
                <span>כשר</span>
            </a>
            <button id="floating-tools-btn" class="flex flex-col items-center text-xs gap-1 p-1 hover:text-brand-600 w-1/4">
                <i class="fa-solid fa-screwdriver-wrench fa-lg"></i>
                <span>כלים</span>
            </button>
        </div>
      </nav>
  </div>
  
  <!-- LeafletJS for Live Map -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  
  <!-- Link to the external JavaScript file -->
  <script type="module" src="app.js"></script>

</body>
</html>
